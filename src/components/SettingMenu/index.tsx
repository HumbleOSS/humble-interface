import * as React from "react";
import Menu from "@mui/material/Menu";
import MenuItem from "@mui/material/MenuItem";
import styled from "styled-components";
import { PROVIDER_ID, useWallet } from "@txnlab/use-wallet";
import ArrowDownwardIcon from "static/icon/icon-arrow-downward.svg";
import CogIcon from "static/icon/icon-cog.svg";
import ArrowDownwardIcon2 from "static/icon/icon-arrow-downward-color.svg";
import OnIcon from "static/icon/icon-on.svg";
import { compactAddress } from "../../utils/mp";
import { Box, Divider } from "@mui/material";
import ThemeSelector from "../ThemeSelector";
import { useSelector } from "react-redux";
import { RootState } from "../../store/store";

const SettingDropdown = styled.div`
  /* Layout */
  display: flex;
  padding: 7px 8px;
  justify-content: center;
  align-items: center;
  gap: 4px;
  /* Style */
  border-radius: 12px;
  border: 1px solid var(--Color-Brand-White, #fff);
  /* Extra */
  cursor: pointer;
`;

const SettingMenu = styled(Menu)`
  padding: 24px;
`;

const SwitchContainer = styled.div`
  cursor: pointer;
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  gap: var(--Spacing-200, 4px);
  align-self: stretch;
`;

const LightSwitch = () => {
  return (
    <svg
      width="181"
      height="52"
      viewBox="0 0 181 52"
      fill="none"
      xmlns="http://www.w3.org/2000/svg"
    >
      <path
        d="M0 16C0 7.16344 7.16344 0 16 0H165C173.837 0 181 7.16344 181 16V36C181 44.8366 173.837 52 165 52H16C7.16345 52 0 44.8366 0 36V16Z"
        fill="#141010"
      />
      <path
        d="M4 16C4 9.37258 9.37258 4 16 4H76.5C83.1274 4 88.5 9.37258 88.5 16V36C88.5 42.6274 83.1274 48 76.5 48H16C9.37258 48 4 42.6274 4 36V16Z"
        fill="white"
      />
      <path
        d="M30.412 31.5V21.07H31.784V30.24H36.362V31.5H30.412ZM37.7502 31.5V23.954H39.0522V31.5H37.7502ZM37.7502 22.75V21.07H39.0522V22.75H37.7502ZM44.6705 34.58C44.1385 34.58 43.6438 34.496 43.1865 34.328C42.7385 34.16 42.3511 33.9267 42.0245 33.628C41.7071 33.3387 41.4645 32.998 41.2965 32.606L42.5145 32.046C42.6451 32.4007 42.8925 32.6993 43.2565 32.942C43.6298 33.194 44.0965 33.32 44.6565 33.32C45.0858 33.32 45.4731 33.236 45.8185 33.068C46.1731 32.9093 46.4531 32.6667 46.6585 32.34C46.8638 32.0227 46.9665 31.6353 46.9665 31.178V29.484L47.2045 29.736C46.9431 30.2493 46.5651 30.6413 46.0705 30.912C45.5851 31.1827 45.0485 31.318 44.4605 31.318C43.7511 31.318 43.1165 31.1547 42.5565 30.828C41.9965 30.492 41.5578 30.0393 41.2405 29.47C40.9231 28.8913 40.7645 28.252 40.7645 27.552C40.7645 26.8427 40.9231 26.2033 41.2405 25.634C41.5578 25.0647 41.9918 24.6167 42.5425 24.29C43.1025 23.954 43.7371 23.786 44.4465 23.786C45.0345 23.786 45.5665 23.9213 46.0425 24.192C46.5278 24.4533 46.9151 24.8173 47.2045 25.284L47.0085 25.634V23.954H48.2825V31.178C48.2825 31.8313 48.1285 32.4147 47.8205 32.928C47.5125 33.4413 47.0831 33.8427 46.5325 34.132C45.9911 34.4307 45.3705 34.58 44.6705 34.58ZM44.5725 30.058C45.0205 30.058 45.4218 29.946 45.7765 29.722C46.1405 29.498 46.4298 29.1993 46.6445 28.826C46.8591 28.4433 46.9665 28.0187 46.9665 27.552C46.9665 27.0947 46.8591 26.6747 46.6445 26.292C46.4298 25.9093 46.1405 25.606 45.7765 25.382C45.4218 25.158 45.0205 25.046 44.5725 25.046C44.1151 25.046 43.6998 25.158 43.3265 25.382C42.9531 25.606 42.6591 25.9093 42.4445 26.292C42.2391 26.6653 42.1365 27.0853 42.1365 27.552C42.1365 28.0187 42.2391 28.4433 42.4445 28.826C42.6591 29.1993 42.9485 29.498 43.3125 29.722C43.6858 29.946 44.1058 30.058 44.5725 30.058ZM50.301 31.5V20.902H51.603V25.424L51.365 25.298C51.5516 24.822 51.8503 24.4533 52.261 24.192C52.681 23.9213 53.171 23.786 53.731 23.786C54.2723 23.786 54.753 23.9073 55.173 24.15C55.6023 24.3927 55.9383 24.7287 56.181 25.158C56.433 25.5873 56.559 26.0727 56.559 26.614V31.5H55.243V27.034C55.243 26.614 55.1636 26.2593 55.005 25.97C54.8556 25.6807 54.6456 25.4567 54.375 25.298C54.1043 25.13 53.7916 25.046 53.437 25.046C53.0916 25.046 52.779 25.13 52.499 25.298C52.219 25.4567 51.9996 25.6853 51.841 25.984C51.6823 26.2733 51.603 26.6233 51.603 27.034V31.5H50.301ZM61.4881 31.584C60.7507 31.584 60.1814 31.374 59.7801 30.954C59.3881 30.534 59.1921 29.9413 59.1921 29.176V25.2H57.8201V23.954H58.1001C58.4361 23.954 58.7021 23.8513 58.8981 23.646C59.0941 23.4407 59.1921 23.17 59.1921 22.834V22.218H60.4941V23.954H62.1881V25.2H60.4941V29.134C60.4941 29.386 60.5314 29.6053 60.6061 29.792C60.6901 29.9787 60.8254 30.128 61.0121 30.24C61.1987 30.3427 61.4461 30.394 61.7541 30.394C61.8194 30.394 61.8987 30.3893 61.9921 30.38C62.0947 30.3707 62.1881 30.3613 62.2721 30.352V31.5C62.1507 31.528 62.0154 31.5467 61.8661 31.556C61.7167 31.5747 61.5907 31.584 61.4881 31.584Z"
        fill="#41137E"
      />
      <path
        opacity="0.5"
        d="M120.394 31.5V21.07H123.81C124.865 21.07 125.784 21.2847 126.568 21.714C127.352 22.1433 127.959 22.75 128.388 23.534C128.818 24.3087 129.032 25.2233 129.032 26.278C129.032 27.3233 128.818 28.238 128.388 29.022C127.959 29.806 127.352 30.4173 126.568 30.856C125.784 31.2853 124.865 31.5 123.81 31.5H120.394ZM121.766 30.24H123.824C124.599 30.24 125.266 30.0767 125.826 29.75C126.396 29.4233 126.834 28.966 127.142 28.378C127.45 27.7807 127.604 27.0807 127.604 26.278C127.604 25.466 127.446 24.766 127.128 24.178C126.82 23.59 126.382 23.1373 125.812 22.82C125.252 22.4933 124.59 22.33 123.824 22.33H121.766V30.24ZM132.734 31.668C132.239 31.668 131.8 31.5793 131.418 31.402C131.044 31.2153 130.75 30.9633 130.536 30.646C130.321 30.3193 130.214 29.946 130.214 29.526C130.214 29.1247 130.298 28.7653 130.466 28.448C130.643 28.1213 130.914 27.846 131.278 27.622C131.651 27.398 132.118 27.2393 132.678 27.146L135.478 26.684V27.776L132.972 28.196C132.486 28.28 132.132 28.434 131.908 28.658C131.693 28.882 131.586 29.1573 131.586 29.484C131.586 29.792 131.707 30.0487 131.95 30.254C132.202 30.4593 132.514 30.562 132.888 30.562C133.364 30.562 133.774 30.464 134.12 30.268C134.474 30.0627 134.75 29.7873 134.946 29.442C135.151 29.0967 135.254 28.714 135.254 28.294V26.376C135.254 25.9653 135.1 25.634 134.792 25.382C134.493 25.1207 134.096 24.99 133.602 24.99C133.172 24.99 132.79 25.102 132.454 25.326C132.127 25.5407 131.884 25.83 131.726 26.194L130.592 25.606C130.732 25.2607 130.956 24.9527 131.264 24.682C131.572 24.402 131.931 24.1827 132.342 24.024C132.752 23.8653 133.182 23.786 133.63 23.786C134.208 23.786 134.717 23.898 135.156 24.122C135.594 24.3367 135.935 24.64 136.178 25.032C136.43 25.4147 136.556 25.8627 136.556 26.376V31.5H135.282V30.072L135.52 30.156C135.361 30.4547 135.146 30.716 134.876 30.94C134.605 31.164 134.288 31.3413 133.924 31.472C133.56 31.6027 133.163 31.668 132.734 31.668ZM138.574 31.5V23.954H139.848V25.34L139.708 25.144C139.886 24.7147 140.156 24.3973 140.52 24.192C140.884 23.9773 141.328 23.87 141.85 23.87H142.312V25.102H141.654C141.122 25.102 140.693 25.27 140.366 25.606C140.04 25.9327 139.876 26.3993 139.876 27.006V31.5H138.574ZM143.469 31.5V20.902H144.771V28.168L144.239 28.042L148.243 23.954H149.909L147.011 26.992L150.105 31.5H148.565L145.737 27.412L146.549 27.37L144.351 29.666L144.771 28.714V31.5H143.469Z"
        fill="white"
      />
    </svg>
  );
};

const DarkSwitch = () => {
  return (
    <svg
      width="181"
      height="52"
      viewBox="0 0 181 52"
      fill="none"
      xmlns="http://www.w3.org/2000/svg"
    >
      <path
        d="M0 16C0 7.16344 7.16344 0 16 0H165C173.837 0 181 7.16344 181 16V36C181 44.8366 173.837 52 165 52H16C7.16345 52 0 44.8366 0 36V16Z"
        fill="white"
      />
      <g opacity="0.3">
        <path
          d="M30.412 31.5V21.07H31.784V30.24H36.362V31.5H30.412ZM37.7502 31.5V23.954H39.0522V31.5H37.7502ZM37.7502 22.75V21.07H39.0522V22.75H37.7502ZM44.6705 34.58C44.1385 34.58 43.6438 34.496 43.1865 34.328C42.7385 34.16 42.3511 33.9267 42.0245 33.628C41.7071 33.3387 41.4645 32.998 41.2965 32.606L42.5145 32.046C42.6451 32.4007 42.8925 32.6993 43.2565 32.942C43.6298 33.194 44.0965 33.32 44.6565 33.32C45.0858 33.32 45.4731 33.236 45.8185 33.068C46.1731 32.9093 46.4531 32.6667 46.6585 32.34C46.8638 32.0227 46.9665 31.6353 46.9665 31.178V29.484L47.2045 29.736C46.9431 30.2493 46.5651 30.6413 46.0705 30.912C45.5851 31.1827 45.0485 31.318 44.4605 31.318C43.7511 31.318 43.1165 31.1547 42.5565 30.828C41.9965 30.492 41.5578 30.0393 41.2405 29.47C40.9231 28.8913 40.7645 28.252 40.7645 27.552C40.7645 26.8427 40.9231 26.2033 41.2405 25.634C41.5578 25.0647 41.9918 24.6167 42.5425 24.29C43.1025 23.954 43.7371 23.786 44.4465 23.786C45.0345 23.786 45.5665 23.9213 46.0425 24.192C46.5278 24.4533 46.9151 24.8173 47.2045 25.284L47.0085 25.634V23.954H48.2825V31.178C48.2825 31.8313 48.1285 32.4147 47.8205 32.928C47.5125 33.4413 47.0831 33.8427 46.5325 34.132C45.9911 34.4307 45.3705 34.58 44.6705 34.58ZM44.5725 30.058C45.0205 30.058 45.4218 29.946 45.7765 29.722C46.1405 29.498 46.4298 29.1993 46.6445 28.826C46.8591 28.4433 46.9665 28.0187 46.9665 27.552C46.9665 27.0947 46.8591 26.6747 46.6445 26.292C46.4298 25.9093 46.1405 25.606 45.7765 25.382C45.4218 25.158 45.0205 25.046 44.5725 25.046C44.1151 25.046 43.6998 25.158 43.3265 25.382C42.9531 25.606 42.6591 25.9093 42.4445 26.292C42.2391 26.6653 42.1365 27.0853 42.1365 27.552C42.1365 28.0187 42.2391 28.4433 42.4445 28.826C42.6591 29.1993 42.9485 29.498 43.3125 29.722C43.6858 29.946 44.1058 30.058 44.5725 30.058ZM50.301 31.5V20.902H51.603V25.424L51.365 25.298C51.5516 24.822 51.8503 24.4533 52.261 24.192C52.681 23.9213 53.171 23.786 53.731 23.786C54.2723 23.786 54.753 23.9073 55.173 24.15C55.6023 24.3927 55.9383 24.7287 56.181 25.158C56.433 25.5873 56.559 26.0727 56.559 26.614V31.5H55.243V27.034C55.243 26.614 55.1636 26.2593 55.005 25.97C54.8556 25.6807 54.6456 25.4567 54.375 25.298C54.1043 25.13 53.7916 25.046 53.437 25.046C53.0916 25.046 52.779 25.13 52.499 25.298C52.219 25.4567 51.9996 25.6853 51.841 25.984C51.6823 26.2733 51.603 26.6233 51.603 27.034V31.5H50.301ZM61.4881 31.584C60.7507 31.584 60.1814 31.374 59.7801 30.954C59.3881 30.534 59.1921 29.9413 59.1921 29.176V25.2H57.8201V23.954H58.1001C58.4361 23.954 58.7021 23.8513 58.8981 23.646C59.0941 23.4407 59.1921 23.17 59.1921 22.834V22.218H60.4941V23.954H62.1881V25.2H60.4941V29.134C60.4941 29.386 60.5314 29.6053 60.6061 29.792C60.6901 29.9787 60.8254 30.128 61.0121 30.24C61.1987 30.3427 61.4461 30.394 61.7541 30.394C61.8194 30.394 61.8987 30.3893 61.9921 30.38C62.0947 30.3707 62.1881 30.3613 62.2721 30.352V31.5C62.1507 31.528 62.0154 31.5467 61.8661 31.556C61.7167 31.5747 61.5907 31.584 61.4881 31.584Z"
          fill="#0C0C10"
        />
      </g>
      <path
        d="M92.5 16C92.5 9.37258 97.8726 4 104.5 4H165C171.627 4 177 9.37258 177 16V36C177 42.6274 171.627 48 165 48H104.5C97.8726 48 92.5 42.6274 92.5 36V16Z"
        fill="black"
      />
      <path
        d="M120.394 31.5V21.07H123.81C124.865 21.07 125.784 21.2847 126.568 21.714C127.352 22.1433 127.959 22.75 128.388 23.534C128.818 24.3087 129.032 25.2233 129.032 26.278C129.032 27.3233 128.818 28.238 128.388 29.022C127.959 29.806 127.352 30.4173 126.568 30.856C125.784 31.2853 124.865 31.5 123.81 31.5H120.394ZM121.766 30.24H123.824C124.599 30.24 125.266 30.0767 125.826 29.75C126.396 29.4233 126.834 28.966 127.142 28.378C127.45 27.7807 127.604 27.0807 127.604 26.278C127.604 25.466 127.446 24.766 127.128 24.178C126.82 23.59 126.382 23.1373 125.812 22.82C125.252 22.4933 124.59 22.33 123.824 22.33H121.766V30.24ZM132.734 31.668C132.239 31.668 131.8 31.5793 131.418 31.402C131.044 31.2153 130.75 30.9633 130.536 30.646C130.321 30.3193 130.214 29.946 130.214 29.526C130.214 29.1247 130.298 28.7653 130.466 28.448C130.643 28.1213 130.914 27.846 131.278 27.622C131.651 27.398 132.118 27.2393 132.678 27.146L135.478 26.684V27.776L132.972 28.196C132.486 28.28 132.132 28.434 131.908 28.658C131.693 28.882 131.586 29.1573 131.586 29.484C131.586 29.792 131.707 30.0487 131.95 30.254C132.202 30.4593 132.514 30.562 132.888 30.562C133.364 30.562 133.774 30.464 134.12 30.268C134.474 30.0627 134.75 29.7873 134.946 29.442C135.151 29.0967 135.254 28.714 135.254 28.294V26.376C135.254 25.9653 135.1 25.634 134.792 25.382C134.493 25.1207 134.096 24.99 133.602 24.99C133.172 24.99 132.79 25.102 132.454 25.326C132.127 25.5407 131.884 25.83 131.726 26.194L130.592 25.606C130.732 25.2607 130.956 24.9527 131.264 24.682C131.572 24.402 131.931 24.1827 132.342 24.024C132.752 23.8653 133.182 23.786 133.63 23.786C134.208 23.786 134.717 23.898 135.156 24.122C135.594 24.3367 135.935 24.64 136.178 25.032C136.43 25.4147 136.556 25.8627 136.556 26.376V31.5H135.282V30.072L135.52 30.156C135.361 30.4547 135.146 30.716 134.876 30.94C134.605 31.164 134.288 31.3413 133.924 31.472C133.56 31.6027 133.163 31.668 132.734 31.668ZM138.574 31.5V23.954H139.848V25.34L139.708 25.144C139.886 24.7147 140.156 24.3973 140.52 24.192C140.884 23.9773 141.328 23.87 141.85 23.87H142.312V25.102H141.654C141.122 25.102 140.693 25.27 140.366 25.606C140.04 25.9327 139.876 26.3993 139.876 27.006V31.5H138.574ZM143.469 31.5V20.902H144.771V28.168L144.239 28.042L148.243 23.954H149.909L147.011 26.992L150.105 31.5H148.565L145.737 27.412L146.549 27.37L144.351 29.666L144.771 28.714V31.5H143.469Z"
        fill="white"
      />
    </svg>
  );
};

function BasicMenu() {
  /* Theme */
  const isDarkTheme = useSelector(
    (state: RootState) => state.theme.isDarkTheme
  );
  /* Wallet */
  const { activeAccount, providers, connectedAccounts } = useWallet();
  const [anchorEl, setAnchorEl] = React.useState<null | HTMLElement>(null);
  const open = Boolean(anchorEl);
  const handleClick = (event: React.MouseEvent<HTMLButtonElement>) => {
    setAnchorEl(event.currentTarget);
  };
  const handleClose = () => {
    setAnchorEl(null);
  };
  return (
    <div>
      <SettingDropdown
        id="basic-button"
        aria-controls={open ? "basic-menu" : undefined}
        aria-haspopup="true"
        aria-expanded={open ? "true" : undefined}
        onClick={(e: any) => {
          handleClick(e);
        }}
      >
        <img src={CogIcon} height="24" width="24" />
        <img
          style={{
            transform: open ? "rotate(180deg)" : "rotate(0deg)",
            transition: "transform 0.3s",
          }}
          src={ArrowDownwardIcon2}
        />
      </SettingDropdown>

      <SettingMenu
        id="basic-menu"
        anchorEl={anchorEl}
        open={open}
        onClose={handleClose}
        MenuListProps={{
          "aria-labelledby": "basic-button",
        }}
        PaperProps={{
          elevation: 0,
          sx: {
            display: "inline-flex",
            padding: "18px",
            flexDirection: "column",
            alignItems: "flex-start",
            gap: "24px",
            borderRadius: "16px",
            overflow: "visible",
            filter: "drop-shadow(0px 2px 8px rgba(0,0,0,0.32))",
            mt: 2,
            "& .MuiAvatar-root": {
              width: 32,
              height: 32,
              ml: -0.5,
              mr: 1,
            },
            background: isDarkTheme
              ? "var(--Color-Brand-Element-Primary, #000)"
              : "var(--Color-Brand-Element-Primary, #fff)",
          },
        }}
        transformOrigin={{ horizontal: "right", vertical: "top" }}
        anchorOrigin={{ horizontal: "right", vertical: "bottom" }}
      >
        <SwitchContainer>
          <ThemeSelector>
            {isDarkTheme ? <DarkSwitch /> : <LightSwitch />}
          </ThemeSelector>
        </SwitchContainer>
      </SettingMenu>
    </div>
  );
}

export default BasicMenu;
